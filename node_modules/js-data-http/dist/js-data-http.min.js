/*!
* js-data-http
* @version 3.0.0 - Homepage <https://github.com/js-data/js-data-http>
* @copyright (c) 2014-2016 js-data-http project authors
* @license MIT <https://github.com/js-data/js-data-http/blob/master/LICENSE>
*
* @overview HTTP (XHR) adapter for js-data in the browser.
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("js-data")):"function"==typeof define&&define.amd?define("js-data-http",["exports","js-data"],t):t(e.JSDataHttp=e.JSDataHttp||{},e.JSData)}(this,function(e,t){"use strict";function Response(e,n,r){n||(n={}),this.data=e,t.utils.fillIn(this,n),this.op=r}function Adapter(e){t.utils.classCallCheck(this,Adapter),t.Component.call(this,e),e||(e={}),t.utils.fillIn(e,l),t.utils.fillIn(this,e)}function isValidString(e){return null!=e&&""!==e}function join(e,t){return t||(t=""),e.filter(isValidString).join(t)}function makePath(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return join(t,"/").replace(/([^:/]|^)\/{2,}/g,"$1/")}function encode(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildUrl(e,n){if(!n)return e;var r=[];return t.utils.forOwn(n,function(e,n){null!==e&&void 0!==e&&(t.utils.isArray(e)||(e=[e]),e.forEach(function(e){"[object Date]"===toString.call(e)?e=e.toISOString():t.utils.isObject(e)&&(e=t.utils.toJson(e)),r.push(encode(n)+"="+encode(e))}))}),r.length>0&&(e+=(-1===e.indexOf("?")?"?":"&")+r.join("&")),e}function HttpAdapter(e){t.utils.classCallCheck(this,HttpAdapter),e||(e={}),t.utils.fillIn(e,d),Adapter.call(this,e)}function addAction(e,n){if(!e||!t.utils.isString(e))throw new TypeError("action(name[, opts]): Expected: string, Found: "+(void 0===e?"undefined":r(e)));return function(r){if(r[e])throw new Error("action(name[, opts]): "+e+" already exists on target!");return n.request=n.request||function(e){return e},n.response=n.response||function(e){return e},n.responseError=n.responseError||function(e){return t.utils.reject(e)},r[e]=function(r,o){var i=this;o=o||{},t.utils.isObject(r)&&(o=r),t.utils.fillIn(o,n);var a=this.getAdapter(o.adapter||this.defaultAdapter||"http"),s={};if(s.mapper=this.name,t.utils.deepMixIn(s,o),s.method=s.method||"GET","function"==typeof o.getEndpoint)s.url=o.getEndpoint(this,o);else{var u=[o.basePath||this.basePath||a.basePath,a.getEndpoint(this,r,o)];t.utils.isSorN(r)&&u.push(r),u.push(n.pathname||e),s.url=makePath.apply(null,u)}return t.utils.resolve(s).then(o.request).then(function(e){return a.HTTP(e)}).then(function(e){return e&&e.config&&(e.config.mapper=i.name),e}).then(o.response,o.responseError)},r}}"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var n=function createCommonjsModule(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e,t){!function webpackUniversalModuleDefinition(t,n){e.exports=n()}(0,function(){return function(e){function __webpack_require__(n){if(t[n])return t[n].exports;var r=t[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,__webpack_require__),r.loaded=!0,r.exports}var t={};return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.p="",__webpack_require__(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){function createInstance(e){var t=new i(e),n=o(i.prototype.request,t);return r.extend(n,i.prototype,t),r.extend(n,t),n}var r=n(2),o=n(3),i=n(5),a=n(6),s=createInstance(a);s.Axios=i,s.create=function create(e){return createInstance(r.merge(a,e))},s.Cancel=n(23),s.CancelToken=n(24),s.isCancel=n(20),s.all=function all(e){return Promise.all(e)},s.spread=n(25),e.exports=s,e.exports.default=s},function(e,t,n){function isArray(e){return"[object Array]"===i.call(e)}function isObject(e){return null!==e&&"object"==typeof e}function isFunction(e){return"[object Function]"===i.call(e)}function forEach(e,t){if(null!==e&&void 0!==e)if("object"==typeof e||isArray(e)||(e=[e]),isArray(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}function merge(){for(var e={},t=0,n=arguments.length;t<n;t++)forEach(arguments[t],function assignValue(t,n){"object"==typeof e[n]&&"object"==typeof t?e[n]=merge(e[n],t):e[n]=t});return e}var r=n(3),o=n(4),i=Object.prototype.toString;e.exports={isArray:isArray,isArrayBuffer:function isArrayBuffer(e){return"[object ArrayBuffer]"===i.call(e)},isBuffer:o,isFormData:function isFormData(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function isArrayBufferView(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function isString(e){return"string"==typeof e},isNumber:function isNumber(e){return"number"==typeof e},isObject:isObject,isUndefined:function isUndefined(e){return void 0===e},isDate:function isDate(e){return"[object Date]"===i.call(e)},isFile:function isFile(e){return"[object File]"===i.call(e)},isBlob:function isBlob(e){return"[object Blob]"===i.call(e)},isFunction:isFunction,isStream:function isStream(e){return isObject(e)&&isFunction(e.pipe)},isURLSearchParams:function isURLSearchParams(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:forEach,merge:merge,extend:function extend(e,t,n){return forEach(t,function assignValue(t,o){e[o]=n&&"function"==typeof t?r(t,n):t}),e},trim:function trim(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t){e.exports=function bind(e,t){return function wrap(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},function(e,t){function isBuffer(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function isSlowBuffer(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&isBuffer(e.slice(0,0))}e.exports=function(e){return null!=e&&(isBuffer(e)||isSlowBuffer(e)||!!e._isBuffer)}},function(e,t,n){function Axios(e){this.defaults=e,this.interceptors={request:new i,response:new i}}var r=n(6),o=n(2),i=n(17),a=n(18),s=n(21),u=n(22);Axios.prototype.request=function request(e){"string"==typeof e&&(e=o.merge({url:arguments[0]},arguments[1])),(e=o.merge(r,this.defaults,{method:"get"},e)).method=e.method.toLowerCase(),e.baseURL&&!s(e.url)&&(e.url=u(e.baseURL,e.url));var t=[a,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach(function unshiftRequestInterceptors(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function pushResponseInterceptors(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n},o.forEach(["delete","get","head","options"],function forEachMethodNoData(e){Axios.prototype[e]=function(t,n){return this.request(o.merge(n||{},{method:e,url:t}))}}),o.forEach(["post","put","patch"],function forEachMethodWithData(e){Axios.prototype[e]=function(t,n,r){return this.request(o.merge(r||{},{method:e,url:t,data:n}))}}),e.exports=Axios},function(e,t,n){function setContentTypeIfUnset(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var r=n(2),o=n(7),i={"Content-Type":"application/x-www-form-urlencoded"},a={adapter:function getDefaultAdapter(){var e;return"undefined"!=typeof XMLHttpRequest?e=n(8):"undefined"!=typeof process&&(e=n(8)),e}(),transformRequest:[function transformRequest(e,t){return o(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e)?e:r.isArrayBufferView(e)?e.buffer:r.isURLSearchParams(e)?(setContentTypeIfUnset(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):r.isObject(e)?(setContentTypeIfUnset(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function transformResponse(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function validateStatus(e){return e>=200&&e<300}};a.headers={common:{Accept:"application/json, text/plain, */*"}},r.forEach(["delete","get","head"],function forEachMethodNoData(e){a.headers[e]={}}),r.forEach(["post","put","patch"],function forEachMethodWithData(e){a.headers[e]=r.merge(i)}),e.exports=a},function(e,t,n){var r=n(2);e.exports=function normalizeHeaderName(e,t){r.forEach(e,function processHeader(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])})}},function(e,t,n){var r=n(2),o=n(9),i=n(12),a=n(13),s=n(14),u=n(10),f="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||n(15);e.exports=function xhrAdapter(e){return new Promise(function dispatchXhrRequest(t,l){var c=e.data,d=e.headers;r.isFormData(c)&&delete d["Content-Type"];var p=new XMLHttpRequest,h="onreadystatechange",y=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in p||s(e.url)||(p=new window.XDomainRequest,h="onload",y=!0,p.onprogress=function handleProgress(){},p.ontimeout=function handleTimeout(){}),e.auth){var m=e.auth.username||"",v=e.auth.password||"";d.Authorization="Basic "+f(m+":"+v)}if(p.open(e.method.toUpperCase(),i(e.url,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,p[h]=function handleLoad(){if(p&&(4===p.readyState||y)&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))){var n="getAllResponseHeaders"in p?a(p.getAllResponseHeaders()):null,r={data:e.responseType&&"text"!==e.responseType?p.response:p.responseText,status:1223===p.status?204:p.status,statusText:1223===p.status?"No Content":p.statusText,headers:n,config:e,request:p};o(t,l,r),p=null}},p.onerror=function handleError(){l(u("Network Error",e,null,p)),p=null},p.ontimeout=function handleTimeout(){l(u("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",p)),p=null},r.isStandardBrowserEnv()){var g=n(16),b=(e.withCredentials||s(e.url))&&e.xsrfCookieName?g.read(e.xsrfCookieName):void 0;b&&(d[e.xsrfHeaderName]=b)}if("setRequestHeader"in p&&r.forEach(d,function setRequestHeader(e,t){void 0===c&&"content-type"===t.toLowerCase()?delete d[t]:p.setRequestHeader(t,e)}),e.withCredentials&&(p.withCredentials=!0),e.responseType)try{p.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&p.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function onCanceled(e){p&&(p.abort(),l(e),p=null)}),void 0===c&&(c=null),p.send(c)})}},function(e,t,n){var r=n(10);e.exports=function settle(e,t,n){var o=n.config.validateStatus;n.status&&o&&!o(n.status)?t(r("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},function(e,t,n){var r=n(11);e.exports=function createError(e,t,n,o,i){var a=new Error(e);return r(a,t,n,o,i)}},function(e,t){e.exports=function enhanceError(e,t,n,r,o){return e.config=t,n&&(e.code=n),e.request=r,e.response=o,e}},function(e,t,n){function encode(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var r=n(2);e.exports=function buildURL(e,t,n){if(!t)return e;var o;if(n)o=n(t);else if(r.isURLSearchParams(t))o=t.toString();else{var i=[];r.forEach(t,function serialize(e,t){null!==e&&void 0!==e&&(r.isArray(e)&&(t+="[]"),r.isArray(e)||(e=[e]),r.forEach(e,function parseValue(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),i.push(encode(t)+"="+encode(e))}))}),o=i.join("&")}return o&&(e+=(-1===e.indexOf("?")?"?":"&")+o),e}},function(e,t,n){var r=n(2);e.exports=function parseHeaders(e){var t,n,o,i={};return e?(r.forEach(e.split("\n"),function parser(e){o=e.indexOf(":"),t=r.trim(e.substr(0,o)).toLowerCase(),n=r.trim(e.substr(o+1)),t&&(i[t]=i[t]?i[t]+", "+n:n)}),i):i}},function(e,t,n){var r=n(2);e.exports=r.isStandardBrowserEnv()?function standardBrowserEnv(){function resolveURL(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");return e=resolveURL(window.location.href),function isURLSameOrigin(t){var n=r.isString(t)?resolveURL(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function nonStandardBrowserEnv(){return function isURLSameOrigin(){return!0}}()},function(e,t){function E(){this.message="String contains an invalid character"}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";E.prototype=new Error,E.prototype.code=5,E.prototype.name="InvalidCharacterError",e.exports=function btoa(e){for(var t,r,o=String(e),i="",a=0,s=n;o.charAt(0|a)||(s="=",a%1);i+=s.charAt(63&t>>8-a%1*8)){if((r=o.charCodeAt(a+=.75))>255)throw new E;t=t<<8|r}return i}},function(e,t,n){var r=n(2);e.exports=r.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(e,t,n,o,i,a){var s=[];s.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.isString(o)&&s.push("path="+o),r.isString(i)&&s.push("domain="+i),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function read(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function remove(e){this.write(e,"",Date.now()-864e5)}}}():function nonStandardBrowserEnv(){return{write:function write(){},read:function read(){return null},remove:function remove(){}}}()},function(e,t,n){function InterceptorManager(){this.handlers=[]}var r=n(2);InterceptorManager.prototype.use=function use(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},InterceptorManager.prototype.eject=function eject(e){this.handlers[e]&&(this.handlers[e]=null)},InterceptorManager.prototype.forEach=function forEach(e){r.forEach(this.handlers,function forEachHandler(t){null!==t&&e(t)})},e.exports=InterceptorManager},function(e,t,n){function throwIfCancellationRequested(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var r=n(2),o=n(19),i=n(20),a=n(6);e.exports=function dispatchRequest(e){return throwIfCancellationRequested(e),e.headers=e.headers||{},e.data=o(e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),r.forEach(["delete","get","head","post","put","patch","common"],function cleanHeaderConfig(t){delete e.headers[t]}),(e.adapter||a.adapter)(e).then(function onAdapterResolution(t){return throwIfCancellationRequested(e),t.data=o(t.data,t.headers,e.transformResponse),t},function onAdapterRejection(t){return i(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=o(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(e,t,n){var r=n(2);e.exports=function transformData(e,t,n){return r.forEach(n,function transform(n){e=n(e,t)}),e}},function(e,t){e.exports=function isCancel(e){return!(!e||!e.__CANCEL__)}},function(e,t){e.exports=function isAbsoluteURL(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t){e.exports=function combineURLs(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t){function Cancel(e){this.message=e}Cancel.prototype.toString=function toString(){return"Cancel"+(this.message?": "+this.message:"")},Cancel.prototype.__CANCEL__=!0,e.exports=Cancel},function(e,t,n){function CancelToken(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function promiseExecutor(e){t=e});var n=this;e(function cancel(e){n.reason||(n.reason=new r(e),t(n.reason))})}var r=n(23);CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason)throw this.reason},CancelToken.source=function source(){var e;return{token:new CancelToken(function executor(t){e=t}),cancel:e}},e.exports=CancelToken},function(e,t){e.exports=function spread(e){return function wrap(t){return e.apply(null,t)}}}])})}),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},i=function(){function sliceIterator(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return sliceIterator(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function noop(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var o=n[n.length-1];return this.dbg.apply(this,[o.op].concat(n)),t.utils.resolve()},s=function noop2(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var o=n[n.length-2];return this.dbg.apply(this,[o.op].concat(n)),t.utils.resolve()},u=function unique(e){var t={},n=[];return e.forEach(function(e){e in t||(n.push(e),t[e]=0)}),n},f=function withoutRelations(e,n,r){r||(r={}),r.with||(r.with=[]);var o=(e.relationFields||[]).filter(function(e){return-1===r.with.indexOf(e)});return t.utils.omit(n,o)},l={debug:!1,raw:!1};t.Component.extend({constructor:Adapter,afterCount:s,afterCreate:s,afterCreateMany:s,afterDestroy:s,afterDestroyAll:s,afterFind:s,afterFindAll:s,afterSum:s,afterUpdate:s,afterUpdateAll:s,afterUpdateMany:s,beforeCount:a,beforeCreate:a,beforeCreateMany:a,beforeDestroy:a,beforeDestroyAll:a,beforeFind:a,beforeFindAll:a,beforeSum:a,beforeUpdate:a,beforeUpdateAll:a,beforeUpdateMany:a,count:function count(e,n,r){var o=this,a=void 0;return n||(n={}),r||(r={}),a=r.op="beforeCount",t.utils.resolve(this[a](e,n,r)).then(function(){return a=r.op="count",o.dbg(a,e,n,r),t.utils.resolve(o._count(e,n,r))}).then(function(s){var u=i(s,2),f=u[0],l=u[1];l||(l={});var c=new Response(f,l,a);return c=o.respond(c,r),a=r.op="afterCount",t.utils.resolve(o[a](e,n,r,c)).then(function(e){return void 0===e?c:e})})},create:function create(e,n,r){var o=this,a=void 0;return n||(n={}),r||(r={}),a=r.op="beforeCreate",t.utils.resolve(this[a](e,n,r)).then(function(i){return n=void 0===i?n:i,n=f(e,n,r),a=r.op="create",o.dbg(a,e,n,r),t.utils.resolve(o._create(e,n,r))}).then(function(s){var u=i(s,2),f=u[0],l=u[1];l||(l={});var c=new Response(f,l,"create");return c.created=f?1:0,c=o.respond(c,r),a=r.op="afterCreate",t.utils.resolve(o[a](e,n,r,c)).then(function(e){return void 0===e?c:e})})},createMany:function createMany(e,n,r){var o=this,a=void 0;return n||(n={}),r||(r={}),a=r.op="beforeCreateMany",t.utils.resolve(this[a](e,n,r)).then(function(i){return n=void 0===i?n:i,n=n.map(function(t){return f(e,t,r)}),a=r.op="createMany",o.dbg(a,e,n,r),t.utils.resolve(o._createMany(e,n,r))}).then(function(s){var u=i(s,2),f=u[0],l=u[1];f||(f=[]),l||(l={});var c=new Response(f,l,"createMany");return c.created=f.length,c=o.respond(c,r),a=r.op="afterCreateMany",t.utils.resolve(o[a](e,n,r,c)).then(function(e){return void 0===e?c:e})})},destroy:function destroy(e,n,r){var o=this,a=void 0;return r||(r={}),a=r.op="beforeDestroy",t.utils.resolve(this[a](e,n,r)).then(function(){return a=r.op="destroy",o.dbg(a,e,n,r),t.utils.resolve(o._destroy(e,n,r))}).then(function(s){var u=i(s,2),f=u[0],l=u[1];l||(l={});var c=new Response(f,l,"destroy");return c=o.respond(c,r),a=r.op="afterDestroy",t.utils.resolve(o[a](e,n,r,c)).then(function(e){return void 0===e?c:e})})},destroyAll:function destroyAll(e,n,r){var o=this,a=void 0;return n||(n={}),r||(r={}),a=r.op="beforeDestroyAll",t.utils.resolve(this[a](e,n,r)).then(function(){return a=r.op="destroyAll",o.dbg(a,e,n,r),t.utils.resolve(o._destroyAll(e,n,r))}).then(function(s){var u=i(s,2),f=u[0],l=u[1];l||(l={});var c=new Response(f,l,"destroyAll");return c=o.respond(c,r),a=r.op="afterDestroyAll",t.utils.resolve(o[a](e,n,r,c)).then(function(e){return void 0===e?c:e})})},loadBelongsTo:function loadBelongsTo(e,n,r,i){var a=this,s=n.getRelation();if(t.utils.isObject(r)&&!t.utils.isArray(r)){var u=r;return this.find(s,this.makeBelongsToForeignKey(e,n,u),i).then(function(e){n.setLocalField(u,e)})}var f=r.map(function(t){return a.makeBelongsToForeignKey(e,n,t)}).filter(function(e){return e});return this.findAll(s,{where:o({},s.idAttribute,{in:f})},i).then(function(e){r.forEach(function(t){e.forEach(function(e){e[s.idAttribute]===t[n.foreignKey]&&n.setLocalField(t,e)})})})},find:function find(e,n,r){var o=this,a=void 0;return r||(r={}),r.with||(r.with=[]),a=r.op="beforeFind",t.utils.resolve(this[a](e,n,r)).then(function(){return a=r.op="find",o.dbg(a,e,n,r),t.utils.resolve(o._find(e,n,r))}).then(function(t){return o.loadRelationsFor(e,t,r)}).then(function(s){var u=i(s,2),f=u[0],l=new Response(f,u[1],"find");return l.found=f?1:0,l=o.respond(l,r),a=r.op="afterFind",t.utils.resolve(o[a](e,n,r,l)).then(function(e){return void 0===e?l:e})})},findAll:function findAll(e,n,r){var o=this,a=void 0;r||(r={}),r.with||(r.with=[]);var s=r._activeWith;if(t.utils.isObject(s)){var u=s.query||{};s.replace?n=u:t.utils.deepFillIn(n,u)}return a=r.op="beforeFindAll",t.utils.resolve(this[a](e,n,r)).then(function(){return a=r.op="findAll",o.dbg(a,e,n,r),t.utils.resolve(o._findAll(e,n,r))}).then(function(t){return o.loadRelationsFor(e,t,r)}).then(function(s){var u=i(s,2),f=u[0],l=new Response(f,u[1],"findAll");return l.found=f.length,l=o.respond(l,r),a=r.op="afterFindAll",t.utils.resolve(o[a](e,n,r,l)).then(function(e){return void 0===e?l:e})})},loadRelationsFor:function loadRelationsFor(e,n,r){var o=this,a=i(n,1)[0],s=[];return a&&t.utils.forEachRelation(e,r,function(t,n){var r=void 0;!t.foreignKey||"hasOne"!==t.type&&"hasMany"!==t.type?"hasMany"===t.type&&t.localKeys?r=o.loadHasManyLocalKeys(e,t,a,n):"hasMany"===t.type&&t.foreignKeys?r=o.loadHasManyForeignKeys(e,t,a,n):"belongsTo"===t.type&&(r=o.loadBelongsTo(e,t,a,n)):r="hasOne"===t.type?o.loadHasOne(e,t,a,n):o.loadHasMany(e,t,a,n),r&&s.push(r)}),t.utils.Promise.all(s).then(function(){return n})},getOpt:function getOpt(e,n){return n||(n={}),void 0===n[e]?t.utils.plainCopy(this[e]):t.utils.plainCopy(n[e])},loadHasMany:function loadHasMany(e,n,r,o){var i=this,a=!1;t.utils.isObject(r)&&!t.utils.isArray(r)&&(a=!0,r=[r]);var s=r.map(function(t){return i.makeHasManyForeignKey(e,n,t)}),u={where:{}},f=u.where[n.foreignKey]={};return a?f["=="]=s[0]:f.in=s.filter(function(e){return e}),this.findAll(n.getRelation(),u,o).then(function(o){r.forEach(function(r){var i=[];a?i=o:o.forEach(function(o){t.utils.get(o,n.foreignKey)===r[e.idAttribute]&&i.push(o)}),n.setLocalField(r,i)})})},loadHasManyLocalKeys:function loadHasManyLocalKeys(e,n,r,i){var a=this,s=void 0,f=n.getRelation();if(t.utils.isObject(r)&&!t.utils.isArray(r)&&(s=r),s)return this.findAll(f,{where:o({},f.idAttribute,{in:this.makeHasManyLocalKeys(e,n,s)})},i).then(function(e){n.setLocalField(s,e)});var l=[];return r.forEach(function(t){l=l.concat(a.makeHasManyLocalKeys(e,n,t))}),this.findAll(f,{where:o({},f.idAttribute,{in:u(l).filter(function(e){return e})})},i).then(function(e){return r.forEach(function(r){var o=[],i=t.utils.get(r,n.localKeys)||[];i=t.utils.isArray(i)?i:Object.keys(i),e.forEach(function(e){i&&-1!==i.indexOf(e[f.idAttribute])&&o.push(e)}),n.setLocalField(r,o)}),e})},loadHasManyForeignKeys:function loadHasManyForeignKeys(e,n,r,i){var a=this,s=n.getRelation(),u=e.idAttribute,f=void 0;return t.utils.isObject(r)&&!t.utils.isArray(r)&&(f=r),f?this.findAll(n.getRelation(),{where:o({},n.foreignKeys,{contains:this.makeHasManyForeignKeys(e,n,f)})},i).then(function(e){n.setLocalField(f,e)}):this.findAll(s,{where:o({},n.foreignKeys,{isectNotEmpty:r.map(function(t){return a.makeHasManyForeignKeys(e,n,t)})})},i).then(function(e){var o=n.foreignKeys;r.forEach(function(r){var i=[],a=t.utils.get(r,u);e.forEach(function(n){-1!==(t.utils.get(e,o)||[]).indexOf(a)&&i.push(n)}),n.setLocalField(r,i)})})},loadHasOne:function loadHasOne(e,n,r,o){return t.utils.isObject(r)&&!t.utils.isArray(r)&&(r=[r]),this.loadHasMany(e,n,r,o).then(function(){r.forEach(function(e){var r=n.getLocalField(e);t.utils.isArray(r)&&r.length&&n.setLocalField(e,r[0])})})},makeHasManyForeignKey:function makeHasManyForeignKey(e,t,n){return t.getForeignKey(n)},makeHasManyLocalKeys:function makeHasManyLocalKeys(e,n,r){var o=[],i=t.utils.get(r,n.localKeys)||[];return i=t.utils.isArray(i)?i:Object.keys(i),o=o.concat(i),u(o).filter(function(e){return e})},makeHasManyForeignKeys:function makeHasManyForeignKeys(e,n,r){return t.utils.get(r,e.idAttribute)},makeBelongsToForeignKey:function makeBelongsToForeignKey(e,t,n){return t.getForeignKey(n)},sum:function sum(e,n,r,o){var a=this,s=void 0;if(!t.utils.isString(n))throw new Error("field must be a string!");return r||(r={}),o||(o={}),s=o.op="beforeSum",t.utils.resolve(this[s](e,n,r,o)).then(function(){return s=o.op="sum",a.dbg(s,e,n,r,o),t.utils.resolve(a._sum(e,n,r,o))}).then(function(u){var f=i(u,2),l=f[0],c=f[1];c||(c={});var d=new Response(l,c,s);return d=a.respond(d,o),s=o.op="afterSum",t.utils.resolve(a[s](e,n,r,o,d)).then(function(e){return void 0===e?d:e})})},respond:function respond(e,t){return this.getOpt("raw",t)?e:e.data},update:function update(e,n,r,o){var a=this;r||(r={}),o||(o={});var s=void 0;return s=o.op="beforeUpdate",t.utils.resolve(this[s](e,n,r,o)).then(function(i){return r=void 0===i?r:i,r=f(e,r,o),s=o.op="update",a.dbg(s,e,n,r,o),t.utils.resolve(a._update(e,n,r,o))}).then(function(u){var f=i(u,2),l=f[0],c=f[1];c||(c={});var d=new Response(l,c,"update");return d.updated=l?1:0,d=a.respond(d,o),s=o.op="afterUpdate",t.utils.resolve(a[s](e,n,r,o,d)).then(function(e){return void 0===e?d:e})})},updateAll:function updateAll(e,n,r,o){var a=this;n||(n={}),r||(r={}),o||(o={});var s=void 0;return s=o.op="beforeUpdateAll",t.utils.resolve(this[s](e,n,r,o)).then(function(i){return n=void 0===i?n:i,n=f(e,n,o),s=o.op="updateAll",a.dbg(s,e,n,r,o),t.utils.resolve(a._updateAll(e,n,r,o))}).then(function(u){var f=i(u,2),l=f[0],c=f[1];l||(l=[]),c||(c={});var d=new Response(l,c,"updateAll");return d.updated=l.length,d=a.respond(d,o),s=o.op="afterUpdateAll",t.utils.resolve(a[s](e,n,r,o,d)).then(function(e){return void 0===e?d:e})})},updateMany:function updateMany(e,n,r){var o=this;n||(n=[]),r||(r={});var a=void 0,s=e.idAttribute;return n=n.filter(function(e){return t.utils.get(e,s)}),a=r.op="beforeUpdateMany",t.utils.resolve(this[a](e,n,r)).then(function(i){return n=void 0===i?n:i,n=n.map(function(t){return f(e,t,r)}),a=r.op="updateMany",o.dbg(a,e,n,r),t.utils.resolve(o._updateMany(e,n,r))}).then(function(s){var u=i(s,2),f=u[0],l=u[1];f||(f=[]),l||(l={});var c=new Response(f,l,"updateMany");return c.updated=f.length,c=o.respond(c,r),a=r.op="afterUpdateMany",t.utils.resolve(o[a](e,n,r,c)).then(function(e){return void 0===e?c:e})})}});var c=!1;try{c=window&&window.fetch}catch(e){}var d={basePath:"",forceTrailingSlash:!1,hasFetch:c,http:n,httpConfig:{},suffix:"",useFetch:!1};Adapter.extend({constructor:HttpAdapter,afterDEL:s,afterGET:s,afterHTTP:s,afterPOST:s,afterPUT:s,beforeDEL:a,beforeGET:a,beforeHTTP:a,beforePOST:a,beforePUT:a,_count:function _count(e,t,n){var r=this;return this.GET(this.getPath("count",e,n.params,n),n).then(function(t){return r._end(e,n,t)})},_create:function _create(e,t,n){var r=this;return this.POST(this.getPath("create",e,t,n),this.serialize(e,t,n),n).then(function(t){return r._end(e,n,t)})},_createMany:function _createMany(e,t,n){var r=this;return this.POST(this.getPath("createMany",e,null,n),this.serialize(e,t,n),n).then(function(t){return r._end(e,n,t)})},_destroy:function _destroy(e,t,n){var r=this;return this.DEL(this.getPath("destroy",e,t,n),n).then(function(t){return r._end(e,n,t)})},_destroyAll:function _destroyAll(e,t,n){var r=this;return this.DEL(this.getPath("destroyAll",e,null,n),n).then(function(t){return r._end(e,n,t)})},_end:function _end(e,t,n){return[this.deserialize(e,n,t),n]},_find:function _find(e,t,n){var r=this;return this.GET(this.getPath("find",e,t,n),n).then(function(t){return r._end(e,n,t)})},_findAll:function _findAll(e,t,n){var r=this;return this.GET(this.getPath("findAll",e,n.params,n),n).then(function(t){return r._end(e,n,t)})},_sum:function _sum(e,t,n,r){var o=this;return this.GET(this.getPath("sum",e,r.params,r),r).then(function(t){return o._end(e,r,t)})},_update:function _update(e,t,n,r){var o=this;return this.PUT(this.getPath("update",e,t,r),this.serialize(e,n,r),r).then(function(t){return o._end(e,r,t)})},_updateAll:function _updateAll(e,t,n,r){var o=this;return this.PUT(this.getPath("updateAll",e,null,r),this.serialize(e,t,r),r).then(function(t){return o._end(e,r,t)})},_updateMany:function _updateMany(e,t,n){var r=this;return this.PUT(this.getPath("updateMany",e,null,n),this.serialize(e,t,n),n).then(function(t){return r._end(e,n,t)})},count:function count(e,n,r){return n||(n={}),r||(r={}),r.params=this.getParams(r),r.params.count=!0,r.suffix=this.getSuffix(e,r),t.utils.deepMixIn(r.params,n),r.params=this.queryTransform(e,r.params,r),Adapter.prototype.count.call(this,e,n,r)},create:function create(e,t,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(e,n.params,n),n.suffix=this.getSuffix(e,n),Adapter.prototype.create.call(this,e,t,n)},createMany:function createMany(e,t,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(e,n.params,n),n.suffix=this.getSuffix(e,n),Adapter.prototype.createMany.call(this,e,t,n)},DEL:function DEL(e,n,r){var o=this,i=void 0;return n||(n={}),r||(r={}),n.url=e||n.url,n.method=n.method||"delete",i=r.op="beforeDEL",t.utils.resolve(this[i](e,n,r)).then(function(t){return n=void 0===t?n:t,i=r.op="DEL",o.dbg(i,e,n,r),o.HTTP(n,r)}).then(function(a){return i=r.op="afterDEL",t.utils.resolve(o[i](e,n,r,a)).then(function(e){return void 0===e?a:e})})},deserialize:function deserialize(e,n,r){return r||(r={}),t.utils.isFunction(r.deserialize)?r.deserialize(e,n,r):t.utils.isFunction(e.deserialize)?e.deserialize(e,n,r):n&&n.hasOwnProperty("data")?n.data:n},destroy:function destroy(e,t,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(e,n.params,n),n.suffix=this.getSuffix(e,n),Adapter.prototype.destroy.call(this,e,t,n)},destroyAll:function destroyAll(e,n,r){return n||(n={}),r||(r={}),r.params=this.getParams(r),t.utils.deepMixIn(r.params,n),r.params=this.queryTransform(e,r.params,r),r.suffix=this.getSuffix(e,r),Adapter.prototype.destroyAll.call(this,e,n,r)},error:function error(){if(console){var e;(e=console)["function"==typeof console.error?"error":"log"].apply(e,arguments)}},fetch:function(e){function fetch(t){return e.apply(this,arguments)}return fetch.toString=function(){return e.toString()},fetch}(function(e){var n={method:e.method,headers:new Headers(e.headers||{})};return e.data&&(n.body=t.utils.toJson(e.data)),fetch(buildUrl(e.url,e.params),n).then(function(t){return t.config={method:e.method,url:e.url},t.json().then(function(e){return t.data=e,t})})}),find:function find(e,t,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(e,n.params,n),n.suffix=this.getSuffix(e,n),Adapter.prototype.find.call(this,e,t,n)},findAll:function findAll(e,n,r){return n||(n={}),r||(r={}),r.params=this.getParams(r),r.suffix=this.getSuffix(e,r),t.utils.deepMixIn(r.params,n),r.params=this.queryTransform(e,r.params,r),Adapter.prototype.findAll.call(this,e,n,r)},GET:function GET(e,n,r){var o=this,i=void 0;return n||(n={}),r||(r={}),n.url=e||n.url,n.method=n.method||"get",i=r.op="beforeGET",t.utils.resolve(this[i](e,n,r)).then(function(t){return n=void 0===t?n:t,i=r.op="GET",o.dbg(i,e,n,r),o.HTTP(n,r)}).then(function(a){return i=r.op="afterGET",t.utils.resolve(o[i](e,n,r,a)).then(function(e){return void 0===e?a:e})})},getEndpoint:function getEndpoint(e,n,r){var o=this;r||(r={}),r.params=t.utils.isUndefined(r.params)?{}:r.params;var i=e.relationList||[],a=t.utils.isUndefined(r.endpoint)?t.utils.isUndefined(e.endpoint)?e.name:e.endpoint:r.endpoint;return i.forEach(function(e){if("belongsTo"===e.type&&e.parent){var i=void 0,s=e.foreignKey,u=e.getRelation(),f=r.params[s];if(!1===f||!s||!u)return!1===f&&delete r.params[s],!1;if(delete r.params[s],t.utils.isObject(n)&&(i=n),i&&(f=f||e.getForeignKey(i)||(e.getLocalField(i)?t.utils.get(e.getLocalField(i),u.idAttribute):null)),f){delete r.endpoint;var l={};return t.utils.forOwn(r,function(e,t){l[t]=e}),t.utils._(l,u),a=makePath(o.getEndpoint(u,f,l),f,a),!1}}}),a},getPath:function getPath(e,n,r,o){o||(o={});var i=[void 0===o.basePath?void 0===n.basePath?this.basePath:n.basePath:o.basePath,this.getEndpoint(n,t.utils.isString(r)||t.utils.isNumber(r)||"create"===e?r:null,o)];return"find"!==e&&"update"!==e&&"destroy"!==e||i.push(r),makePath.apply(t.utils,i)},getParams:function getParams(e){return e||(e={}),void 0===e.params?{}:t.utils.copy(e.params)},getSuffix:function getSuffix(e,t){return t||(t={}),void 0===t.suffix?void 0===e.suffix?this.suffix:e.suffix:t.suffix},HTTP:function HTTP(e,n){var r=this,o=new Date;n||(n={});var i=e.data,a=e.cache,s=e.timeout;e=t.utils.copy(e,null,null,null,["data","cache","timeout"]),(e=t.utils.deepMixIn(e,this.httpConfig)).data=i,e.cache=a,void 0!==s&&(e.timeout=s),this.forceTrailingSlash&&"/"!==e.url[e.url.length-1]&&(e.url+="/"),e.method=e.method.toUpperCase();var u=e.suffix||n.suffix||this.suffix;u&&e.url.substr(e.url.length-u.length)!==u&&(e.url+=u);var f=function logResponse(n){var i=o.toUTCString()+" - "+e.method.toUpperCase()+" "+e.url+" - "+n.status+" "+((new Date).getTime()-o.getTime())+"ms";return n.status>=200&&n.status<300?(r.log&&r.dbg(i,n),n):(r.error&&r.error("'FAILED: "+i,n),t.utils.reject(n))};if(!this.http){if(!this.useFetch&&!n.useFetch)throw new Error("You have not configured this adapter with an http library!");if(!c)throw new Error("Attempting to use window.fetch, but it is not available!")}return t.utils.resolve(this.beforeHTTP(e,n)).then(function(o){if(e=o||e,c&&(r.useFetch||n.useFetch||!r.http))return r.fetch(e,n).then(f,f);var i=t.utils.plainCopy(e);return delete i.adapter,r.http(i).then(f,f).catch(function(t){return r.responseError(t,e,n)})}).then(function(o){return t.utils.resolve(r.afterHTTP(e,n,o)).then(function(e){return void 0===e?o:e})})},POST:function POST(e,n,r,o){var i=this,a=void 0;return r||(r={}),o||(o={}),r.url=e||r.url,r.data=n||r.data,r.method=r.method||"post",a=o.op="beforePOST",t.utils.resolve(this[a](e,n,r,o)).then(function(t){return r=void 0===t?r:t,a=o.op="POST",i.dbg(a,e,n,r,o),i.HTTP(r,o)}).then(function(s){return a=o.op="afterPOST",t.utils.resolve(i[a](e,n,r,o,s)).then(function(e){return void 0===e?s:e})})},PUT:function PUT(e,n,r,o){var i=this,a=void 0;return r||(r={}),o||(o={}),r.url=e||r.url,r.data=n||r.data,r.method=r.method||"put",a=o.op="beforePUT",t.utils.resolve(this[a](e,n,r,o)).then(function(t){return r=void 0===t?r:t,a=o.op="PUT",i.dbg(a,e,n,r,o),i.HTTP(r,o)}).then(function(s){return a=o.op="afterPUT",t.utils.resolve(i[a](e,n,r,o,s)).then(function(e){return void 0===e?s:e})})},queryTransform:function queryTransform(e,n,r){return r||(r={}),t.utils.isFunction(r.queryTransform)?r.queryTransform(e,n,r):t.utils.isFunction(e.queryTransform)?e.queryTransform(e,n,r):n},responseError:function responseError(e,n,r){return t.utils.reject(e)},serialize:function serialize(e,n,r){return r||(r={}),t.utils.isFunction(r.serialize)?r.serialize(e,n,r):t.utils.isFunction(e.serialize)?e.serialize(e,n,r):n},sum:function sum(e,n,r,o){if(r||(r={}),o||(o={}),!t.utils.isString(n))throw new Error("field must be a string!");return o.params=this.getParams(o),o.params.sum=n,o.suffix=this.getSuffix(e,o),t.utils.deepMixIn(o.params,r),o.params=this.queryTransform(e,o.params,o),Adapter.prototype.sum.call(this,e,n,r,o)},update:function update(e,t,n,r){return r||(r={}),r.params=this.getParams(r),r.params=this.queryTransform(e,r.params,r),r.suffix=this.getSuffix(e,r),Adapter.prototype.update.call(this,e,t,n,r)},updateAll:function updateAll(e,n,r,o){return r||(r={}),o||(o={}),o.params=this.getParams(o),t.utils.deepMixIn(o.params,r),o.params=this.queryTransform(e,o.params,o),o.suffix=this.getSuffix(e,o),Adapter.prototype.updateAll.call(this,e,n,r,o)},updateMany:function updateMany(e,t,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(e,n.params,n),n.suffix=this.getSuffix(e,n),Adapter.prototype.updateMany.call(this,e,t,n)}});var p={full:"3.0.0",major:3,minor:0,patch:0};e.HttpAdapter=HttpAdapter,e.addAction=addAction,e.addActions=function addActions(e){return e||(e={}),function(n){return t.utils.forOwn(e,function(e,t){addAction(t,e)(n)}),n}},e.version=p,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=js-data-http.min.map